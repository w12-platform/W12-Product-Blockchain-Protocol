# Contribution

 * [Development Setup](#development-setup)
 * [Project structure](#project-structure)
 * [Commands and scripts](#commands-and-scripts)
 * [Testing](#testing)
 * [Migration](#migration)
 * [CI](#ci)
 * [Development](#development)


## Development Setup

You will need install thes tools:

 * [Truffle](https://github.com/trufflesuite/truffle)
 * Development ethereum network. For example: [Ganache UI](https://github.com/trufflesuite/ganache), [Ganache CLI](https://github.com/trufflesuite/ganache-cli)
 * (optional) [solidity-flattener](https://github.com/BlockCatIO/solidity-flattener)
 * (optional) [Solidity compiler](https://solidity.readthedocs.io/en/v0.4.24/installing-solidity.html)
 * Node JS 8+
 * NPM 6+

And than install project dependecies:

```
$ npm install
$ truffle install
```

## Project structure

 * `abi`
    * `<version>` - contains ABIs for all versions of contracts. This ABIs automaticly generated by the script, you will find the script decsription below.
 * `build`
    * `contracts` - here truffle store all compiled contracts.
 * `contracts` - contracts itself
 * `docs` - documentations
 * `migration` - truffle migrate scripts
 * `shared` - shared code for tests, scripts and other
 * `test` - tests
 * `example.config.js` - configuration file for any project purposes. If you want use config, just copy it and rename to `config.js`

## Commands and scripts

All of main commands used in development definded in `packages.json` under `scripts` property. Several commands represent below:

 * `build` - compile contracts and generate ABIs for current version
 * `abi` - generate ABIs for current version
 * `dev-net` - start ethereum local dev network
 * `ci-test` - command used by CI service to run tests
 * `ci-deploy-test-net` - used by CI service to deploy process

All dev scripts stored under `shared/scripts` directory. `create-flatters.sh` creates flatterns versions of contracts, you may use this flatterns to verefy contract code on any block explorer services. `deploy.sh` used to deploy contract.  `generate-abi.js` used to generate ABIs for all contracts of current version, this script uses build result of truffle compile command. ABIs will not be generate if current ABI version of contracts have not diffrent from previosly.

## Testing

Start local network:

```
$ npm run dev-net
```

and then run tests:

```
$ npm run test
```

## Migration

Currently migration written only for test networks. Not recommended run it manualy.

## CI

We use CircleCI to run CI jobs. All CI process cosists of 3 stages:

 1. *Setup*. On this stage CI do setup process: fetch repository, install dependecies and other work.
 2. *Test*. This stage requires to be done Setup stage. On this stage CI do testing job.
 3. *Deploy*. This stage requires to be done Test stage. Stage only triggered by pushing to repository version tag, eg. `v0.0.1`. It runs migrate to test network and commit all truffle migrate results to repository automaticly. Migrate log will be attached to commit body.

## Development

Sending work result. After have done your work send PR to `master` branch and request reviewer to check changes and accept PR.

Deploing new version. Before triggering deploy process you must change version in `package.json`, use `npm version` command to do it correcly, then push new version tag(created by `npm version`) to repository and wait deploy stage to be done.

If you want to skip CI stage add `[ci skip]` tag at any place of your commit.

Do not commit truffle compile results (`build/contracts`).
